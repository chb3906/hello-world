<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
  <title></title>
</head>

<body>
</body>
</html>
<script>

function getQueStr(url, ref) {//取获参数值
    var str = url.substr(url.indexOf('?') + 1);
    if (str.indexOf('&') != -1) {
        var arr = str.split('&');
        for (var i=0;i<arr.length;i++) {
            if (arr[i].split('=')[0] == ref)
                return arr[i].split('=')[1];
        }
    }
    else {
        return url.substr(url.indexOf('=') + 1)
    }
}
 
function delQueStr(url, ref) {//删除参数值
    var str = "";
    if (url.indexOf('?') != -1)
        str = url.substr(url.indexOf('?') + 1);
    else
        return url;
    var arr = "";
    var returnurl = "";
    var setparam = "";
    if (str.indexOf('&') != -1) {
        arr = str.split('&');
        for (var i=0;i<arr.length;i++) {
            if (arr[i].split('=')[0] != ref) {
                returnurl = returnurl + arr[i].split('=')[0] + "=" + arr[i].split('=')[1] + "&";
            }
        }
        return url.substr(0, url.indexOf('?')) + "?" + returnurl.substr(0, returnurl.length - 1);
    }
    else {
        arr = str.split('=');
        if (arr[0] == ref)
            return url.substr(0, url.indexOf('?'));
        else
            return url;
    }
}
function getHost(url) 
{
    // var regex = /.*\:\/\/([^\/]*).*/;
    // var regex = /(http:\/\/ | https:\/\/ | [A-Za-z0-9]+[\-]?[A-Za-z0-9]+\.|[A-Za-z0-9]+\.)((\w|=|\?|\.|\/|&|-)*)/g;
    // var regex = /([A-Za-z0-9]+(\.[A-Za-z0-9]+)+)/g;
    var regex = /[A-Za-z0-9]+(\.[A-Za-z0-9]+)*\.(com|net|cn|cc)\//g;
    var match = url.match(regex); 
    if(typeof match == "undefined" || null == match)//若匹配不到
    {
        match = [];
    }
    console.log(match);
    return match;
}

function handleHost(url){
    var flag = true;
    var safeHost = ['.sinosig.com/','.ygbx.com/','.weixin.qq.com/']; //安全域名
    var hostFromUrl = getHost(url);//截取url中的域名
    // var hostFromUrl = ["open.weixin.qq.com", "pw.sinosig.com", "main.do", "wangxiaouat.sinosig.com"]
    if(hostFromUrl.length > 0){
        for(var i=0;i<hostFromUrl.length;i++){
            if(hostFromUrl[i].indexOf(safeHost[0]) == -1 && hostFromUrl[i].indexOf(safeHost[1]) == -1){//若从url中截取的域名不在安全域名之列,则为非法域名
                flag = false;
            }
        }
    }else{
        flag = false;//匹配不到域名也返回false
    }
    return flag;
}

//引导用户授权
(function(){
    var url = window.location.href;
    var shareUrl = getQueStr(url, "shareurl");
    var redirect_uri = decodeURIComponent(shareUrl);
    console.log(redirect_uri);
    console.log(handleHost(redirect_uri));
    // return;
    if(handleHost(redirect_uri)){//若域名校验通过,则跳转
        window.location.href = redirect_uri;
    }else{
        let host = window.location.host
        let hostArr = ['localhost', 'wangxiaouat.sinosig.com', 'mkptest.ygbx.com', 'mkproperty.sinosig.com', 'mkproperty.ygbx.com']
        if (hostArr.indexOf(host) != -1) {
            window.location.href = 'http://'+window.location.host+'/#/errorPage'
        }
        return;
    }
	
})();
</script>